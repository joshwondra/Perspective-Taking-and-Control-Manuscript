

##### 1. Variable List #####

### There are two data files: one for the closed-ended emotion and appraisal data, a second for the open-ended emotion data



### CLOSED-ENDED EMOTION DATA ###


## session info

# SubjectID
# pt_cond: 1 = objective, 2 = perspective taking, 3 = control
# emot_cond: 1 = sad, 2 = angry
# exper: Experimenter's name


## own emotions

# mainfeel_1, mainfeel_2, mainfeel_3: "Now that you've finished reading the letter, what are your main feelings right now?" (open-ended response)
# mainfeel_expl: "Feel free to explain in the space below if you would like" (open-ended response)

# "After reading the letter, how much do you feel each of the following right now?" (1 = Not at all, 5 = Extremely)
#happy, shocked, hopeful, angry, compass (compassionate), interest (interested), disgust (disgusted), mad, curious, afraid, grateful, proud, surprise (surprised), amused, down, worried, frustrated, sad, embarrass (embarrassed), guilt (guilty), selfanger (angry at self), symp (sympathetic) 

## Melissa's emotions

# melfeel_1, melfeel_2, melfeel_3: "What are the letter writer's main feelings about what was described in the letter?" (open-ended response)
# melfeel_expl: "Feel free to explain in the space below if you would like" (open-ended response)

## "How much did the letter writer feel each of the following about what was described in the letter?" (1 = Not at all, 5 = Extremely)
#mhappy, mshocked, mhope, mangry, minterest (interested), mdisgust (disgusted), mmad, mcurious, mafraid, mgrateful, mproud, msurprise (surprised), mamused, mdown, mworried, mfrustrate, msad, membarrass (embarrassed), mguilty (guilty), mselfanger (angry at self)


## own appraisals 
# "Answer the following questions about what the letter writer described in the letter" (1 = Not at all, 5 = Extremely)
# pleas: How unpleasant was it?
# selfag: How much do you feel like you are responsible for what happened?
# targag: How much do you feel that the other participant is responsible for what happened?
# otherag: How much do you feel that someone aside from the other participant is responsible for what happened?
# sitag: How much do you feel that circumstances beyond anyone's control are responsible for what happened?
# mixag: How much do you feel that the situation was caused by a combination of many factors?
# selfpow: How much do you feel like you had the power to do something about the situation?
# targpow: How much do you feel that the other participant had the power to do something about the situation?
# othpow: How much do you feel that someone aside from the other participant had the power to do something about the situation?
# noonepow: How much do you feel that no one had the power to do anything about the situation?
# sitcont: How much do you feel that the situation was out of anyone's control? 
# immoral: To what extent was what happened morally wrong?


## Melissa's appraisals 
# "Answer the following questions about the other participant's perspective on what they described in the letter" (1 = Not at all, 5 = Extremely)
# m_pleas: How unpleasant did the other participant think it was?
# m_selfag: How much does the other participant feel that they are responsible for what happened?
# m_otherag: How much does the other participant feel that someone else is responsible for what happened?
# m_sitag: How much does the other participant feel that circumstances beyond anyon'es control are responsible for what happened?
# m_mixag: How much does the other participant feel that the situation was caused by a combination of many factors?
# m_selfpow: How much does the other participant feel that they had the power to do something about the situation?
# m_otherpow: How much does the other participant feel that someone else had the power to do something abou the situation?
# m_noonepow: How much does the other participant feel that no one had the power to do anything about the situation?
# m_sitpow: How much does the other participant feel that the situation was out of anyone's control? 
# m_immoral: To what extent does the other participant feel that what happened was morally wrong?


## Interpersonal Reactivity Index (1 = Does Not Describe Me Well, 6 = Describes Me Very Well)
# iri_1: I daydream and fantasize, with some regularity, about things that might happen to me (fantasy)
# iri_2: I often have tender, concerned feelings for people less fortunate than me (empathic concern)
# iri_3: I sometimes find it difficult to see things from the "other guy's" point of view (perspective taking) 
# iri_4: Sometimes I don't feel very sorry for other people when they are having problems (empathic concern, reverse-coded)
# iri_5: I really get involved with the feelings of the characters in a novel (fantasy)
# iri_6: In emergency situations, I feel apprehensive and ill-at-ease (personal distress)
# iri_10: I am usually objective when I watch a movie or play, and I don't often get completely caught up in it (fantasy, reverse-coded)
# iri_11: I try to look at everybody's side of a disagreement before I make a decision (perspective taking)
# iri_15: When I see someone being taken advantage of, I feel kind of protective towards them (empathic concern)
# iri_29: I sometimes feel helpless when I am in the middle of a very emotional situation (personal distress)
# iri_30: I sometimes try to understand my friends better by imagining how things look from their perspective (perspective taking)
# iri_32: Becoming extremely involved in a good book or movie is somewhat rare for me (fantasy, reverse-coded)
# iri_33: When I see someone get hurt, I tend to remain calm (personal distress, reverse-coded)
# iri_34: Other people's misfortunes do not usually disturb me a great deal (empathic concern, reverse-coded)
# iri2_19: If I'm sure I'm right about something, I don't waste much time listening to other people's arguments (perspective taking, reverse-coded)
# iri2_22: After seeing a play or movie, I have felt as though I were one of the characters (fantasy)
# iri2_23: Being in a tense emotional situation scares me (personal distress)
# iri2_24: When I see someone being treated unfairly, I sometimes don't feel very much pity for them (empathic concern, reverse-coded)
# iri2_25: I am usually pretty effective in dealing with emergencies (personal distress, reverse-coded)
# iri2_28: I am often quite touched by things that I see happen (empathic concern)
# iri2_35: I believe that there are two sides to every question and try to look at them both (perspective taking)
# iri2_36: I would describe myself as a pretty soft-hearted person (empathic concern)
# iri2_37: When I watch a good movie, I can very easily put myself in the place of a leading character (fantasy)
# iri2_38: I tend to lose control during emergencies (personal distress)
# iri2_39: When I'm upset at someone, I usually try to "put myself in his shoes" for a while (perspective taking)
# iri2_40: When I am reading an interesting story or novel, I imagine how I would feel if the events in the story were happening to me (fantasy)
# iri2_41: When I see someone who badly needs help in an emergency, I go to pieces (personal distress)
# iri2_42: Before criticizing somebody, I try to imagine how I would feel if I were in their place (perspective taking)



### OPEN-ENDED EMOTION DATA ###

# This data set includes subject IDs, the same open-ended emotion items as in the closed-ended data, and codes for the emotion words that subjects used to describe their own feelings and Melissa's feelings (coded as 0's and 1's, with 1's indicating that the subject used the word)



##### 2. Import Data and Load Functions #####


### import data

#NOTE: semi-colons were substituted for commas in the data to prevent problems with using csv files
ptclose <- read.csv('Data/ptdata.csv', header=TRUE) # closed-ended data
ptopen <- read.csv('Data/ptownopen-Master.csv', header=TRUE) # open-ended data
ptdata <- merge(ptclose,ptopen,by='SubjectID')

## Exclude problem subjects
ptdata <- ptdata[ptdata$suspicious!=1 & ptdata$concussion!=1 & ptdata$language!=1 & ptdata$inattention!=1 & ptdata$experimentererror!=1,]


### load functions
source('../R functions/proportion-plot.R')
source('../R functions/mean-plot.R')
source('../R functions/multiplot.R')
source('../R functions/tcontrast.R')


##### 3. Recode Data/Compute New Variables #####

library(car)

# turn experimental conditions into factors
ptdata$ptfactor <- factor(ptdata$pt_cond, levels=c(1,0,2), labels=c('objective','control','perspective taking'))
ptdata$emotfactor <- factor(ptdata$emot_cond, levels=c(1,2), labels=c('sad','angry'))


## create orthogonal sets of contrasts that compare the perspective taking conditions separately for anger and sadness
ptdata$group.numbers <- recode(interaction(ptdata$ptfactor, ptdata$emotfactor), as.factor.result=FALSE, "'objective.sad'=1;'control.sad'=2;'perspective taking.sad'=3;'objective.angry'=4;'control.angry'=5;'perspective taking.angry'=6")
# sad vs. angry total
ptdata$sad.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1:3=-1;4:6=1')

# compare objective and perspective taking conditions
ptdata$OvP.sad <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=-1;2=0;3=1;4=0;5=0;6=0')
ptdata$CvOP.sad <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=-1;2=2;3=-1;4=0;5=0;6=0')
ptdata$OvP.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=0;3=0;4=-1;5=0;6=1')
ptdata$CvOP.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=0;3=0;4=-1;5=2;6=-1')

# compare control and perspective taking conditions
ptdata$CvP.sad <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=-1;3=1;4=0;5=0;6=0')
ptdata$OvCP.sad <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=2;2=-1;3=-1;4=0;5=0;6=0')
ptdata$CvP.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=0;3=0;4=0;5=-1;6=1')
ptdata$OvCP.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=0;3=0;4=2;5=-1;6=-1')

# compare objective and control conditions
ptdata$OvC.sad <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=-1;2=1;3=0;4=0;5=0;6=0')
ptdata$PvOC.sad <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=-1;2=-1;3=2;4=0;5=0;6=0')
ptdata$OvC.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=0;3=0;4=-1;5=1;6=0')
ptdata$PvOC.angry <- recode(ptdata$group.numbers, as.factor.result=FALSE, '1=0;2=0;3=0;4=-1;5=-1;6=2')





##### 4. Analyses of Own Emotions - Open-Ended Data #####

### Prepare open-ended emotion data

## create emotion groups
group.emot <- function(...) {
    vars <- cbind(...)
    code <- (rowSums(vars)>0)*1
    print(table(code))
    return(code)
}

ptdata$open_anger <- with(ptdata, group.emot(o_aggravation, o_agitated, o_anger, o_angry, o_annoyance, o_annoyed, o_bitter, o_furious, o_indignance, o_irritation, o_mad, o_outraged, o_pissed)) #98 cases
ptdata$open_sad <- with(ptdata, group.emot(o_defeat, o_depressed, o_depression, o_despair, o_disappointed, o_disappointing, o_disappointment, o_disheartened, o_down, o_heartbroken, o_helpless, o_helplessness, o_hopeless, o_let_down, o_melancholy, o_sad, o_saddened, o_sadness, o_solemn, o_sorrow, o_want_to_cry)) #213 cases
ptdata$open_sympathy <- with(ptdata, group.emot(o_apologetic, o_caring, o_compassion, o_compassionate, o_concern, o_concerned, o_consoling, o_empathetic, o_empathic, o_empathy, o_pity, o_sorriness, o_sorry, o_sympathetic, o_sympathy, o_wish_i_could_help)) #245 cases
ptdata$open_apathetic <- with(ptdata, group.emot(o_apathetic, o_apathy, o_bored, o_boredom, o_detached, o_disinterest, o_indifference, o_indifferent, o_neutral, o_nonchalant, o_not_interesting, o_unemotional, o_unmoved)) #36 cases
ptdata$open_surprised <- with(ptdata, group.emot(o_astonished, o_astonishment, o_astounded, o_disbelief, o_shock, o_shocked, o_surprise, o_surprised, o_surprisement)) #23 cases
ptdata$open_unpleasant <- with(ptdata, group.emot(o_awful, o_bad, o_badly, o_bummed, o_consternation, o_discomfort, o_dislike, o_dismay, o_distress, o_distressed, o_horribly, o_hurt, o_overwhelmed, o_stress, o_stressed, o_uncomfortable, o_unfortunate, o_unhappiness, o_unhappy, o_unlucky, o_upset)) #120 cases
ptdata$open_confusion <- with(ptdata, group.emot(o_baffled, o_bemused, o_bewilderment, o_confused, o_confusion)) #29 cases
ptdata$open_interest <- with(ptdata, group.emot(o_curiosity, o_curious, o_engaged, o_interest, o_interested, o_intrigue, o_intrigued, o_want_to_know_more)) #41 cases
ptdata$open_frustration <- with(ptdata, group.emot(o_frustrated, o_frustration)) #49 cases



##  Anger

# open-ended plot
with(ptdata, by(open_anger, list(ptfactor, emotfactor), function(x){sum(x)/length(x)}))
prop.anger <- with(ptdata, prop.plot(open_anger, ptfactor, emotfactor, ylab='Proportion Angry', xlab='Perspective Taking Condition', leglab="Target's Emotion"))
prop.anger

# logits with contrasts
# Objective vs. PT
m.oanger.OvP <- glm(open_anger ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oanger.OvP)
## Objective vs. control
m.oanger.OvC <- glm(open_anger ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oanger.OvC)
## PT vs. control
m.oanger.PvC <- glm(open_anger ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oanger.PvC)


##  Sadness

# open-ended plot
with(ptdata, by(open_sad, list(ptfactor, emotfactor), function(x){sum(x)/length(x)}))
prop.sad <- with(ptdata, prop.plot(open_sad, ptfactor, emotfactor, ylab='Proportion Sad', xlab='Perspective Taking Condition', leglab="Target's Emotion"))
prop.sad

# logits with contrasts
# Objective vs. PT
m.osad.OvP <- glm(open_sad ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osad.OvP)
## Objective vs. control
m.osad.OvC <- glm(open_sad ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osad.OvC)
## PT vs. control
m.osad.PvC <- glm(open_sad ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osad.PvC)


##  Sympathy

# open-ended plot
with(ptdata, by(open_sympathy, list(ptfactor, emotfactor), function(x){sum(x)/length(x)}))
prop.symp <- with(ptdata, prop.plot(open_sympathy, ptfactor, emotfactor, ylab='Proportion Sympathy', xlab='Perspective Taking Condition', leglab="Target's Emotion"))
prop.symp

# logits with contrasts
# Objective vs. PT
m.osymp.OvP <- glm(open_sympathy ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osymp.OvP)
## Objective vs. control
m.osymp.OvC <- glm(open_sympathy ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osymp.OvC)
## PT vs. control
m.osymp.PvC <- glm(open_sympathy ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osymp.PvC)

## Check for differences in other emotions

## apathy
# Objective vs. PT
m.oapathetic.OvP <- glm(open_apathetic ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oapathetic.OvP)
## Objective vs. control
m.oapathetic.OvC <- glm(open_apathetic ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oapathetic.OvC)
## PT vs. control
m.oapathetic.PvC <- glm(open_apathetic ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oapathetic.PvC)

## surprise
m.osurprised.OvP <- glm(open_surprised ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osurprised.OvP)
## Objective vs. control
m.osurprised.OvC <- glm(open_surprised ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osurprised.OvC)
## PT vs. control
m.osurprised.PvC <- glm(open_surprised ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.osurprised.PvC)

## unpleasantness
m.ounpleasant.OvP <- glm(open_unpleasant ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ounpleasant.OvP)
## Objective vs. control
m.ounpleasant.OvC <- glm(open_unpleasant ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ounpleasant.OvC)
## PT vs. control
m.ounpleasant.PvC <- glm(open_unpleasant ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ounpleasant.PvC)

## confusion
m.oconfusion.OvP <- glm(open_confusion ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oconfusion.OvP)
## Objective vs. control
m.oconfusion.OvC <- glm(open_confusion ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oconfusion.OvC)
## PT vs. control
m.oconfusion.PvC <- glm(open_confusion ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.oconfusion.PvC)

## interest
m.ointerest.OvP <- glm(open_interest ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ointerest.OvP)
## Objective vs. control
m.ointerest.OvC <- glm(open_interest ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ointerest.OvC)
## PT vs. control
m.ointerest.PvC <- glm(open_interest ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ointerest.PvC)

## frustration
m.ofrustration.OvP <- glm(open_frustration ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ofrustration.OvP)
## Objective vs. control
m.ofrustration.OvC <- glm(open_frustration ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ofrustration.OvC)
## PT vs. control
m.ofrustration.PvC <- glm(open_frustration ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, family=binomial(link='logit'), data=ptdata)
summary(m.ofrustration.PvC)




##### 5. Analyses of Own Emotions - Closed-Ended Data #####

round(cor(ptdata[,c('happy','shocked','hope','angry','comp','interest','disgust','mad','curious','afraid','grateful','proud','surprise','amused','down','worried','frust','sad','embarrass','guilty','selfanger','symp')], use='complete.obs'), digits=2)

sad_mean <- rowMeans(ptdata[,c('sad','down')])
angry_mean <- rowMeans(ptdata[,c('angry','mad')])
symp_mean <- rowMeans(ptdata[,c('symp','comp')])

m.sad.PvC <- lm(sad_mean ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=ptdata)
summary(m.sad.PvC)
m.sad.OvP <- lm(sad_mean ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=ptdata)
summary(m.sad.OvP)
m.sad.OvC <- lm(sad_mean ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=ptdata)
summary(m.sad.OvC)

m.angry.PvC <- lm(angry_mean ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=ptdata)
summary(m.sad.PvC)
m.angry.OvP <- lm(angry_mean ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=ptdata)
summary(m.sad.OvP)
m.angry.OvC <- lm(angry_mean ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=ptdata)
summary(m.sad.OvC)

m.symp.PvC <- lm(symp_mean ~ sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=ptdata)
summary(m.symp.PvC)
m.symp.OvP <- lm(symp_mean ~ sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=ptdata)
summary(m.symp.OvP)
m.symp.OvC <- lm(symp_mean ~ sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=ptdata)
summary(m.symp.OvC)







##### 6. Plots of CIs for objective vs. PT and objective vs. control #####

# ad hoc function
ci.plot <- function(ptcond, emocond, emotions, i, ...){
    ptcond <- factor(rep(ptcond, length(list(...))), )
    emocond <- factor(rep(emocond, length(list(...))), )
    emotions <- factor(emotions)
    point.est <- unlist(lapply(list(...), function(x){coef(x)[i]}))
    lb <- unlist(lapply(list(...), function(x){suppressMessages(confint(x))[i,1]}))
    ub <- unlist(lapply(list(...), function(x){suppressMessages(confint(x))[i,2]}))
    result <- data.frame(ptcond=ptcond, letter=emocond, emotions=emotions, point.est=point.est, lb=lb, ub=ub)
    return(result)
}

OvC.sad <- ci.plot('objective vs. control','sad letter', c('open-ended sadness', 'closed-ended sadness', 'open-ended anger', 'closed-ended anger', 'open-ended sympathy', 'closed-ended sympathy'), i=3, m.osad.OvC, m.sad.OvC, m.oangry.OvC, m.angry.OvC, m.osymp.OvC, m.symp.OvC)
OvC.anger <- ci.plot('objective vs. control','angry letter', c('open-ended sadness', 'closed-ended sadness', 'open-ended anger', 'closed-ended anger', 'open-ended sympathy', 'closed-ended sympathy'), i=5, m.osad.OvC, m.sad.OvC, m.oanger.OvC, m.angry.OvC, m.osymp.OvC, m.symp.OvC)
OvP.sad <- ci.plot('objective vs. perspective taking','sad letter', c('open-ended sadness', 'closed-ended sadness', 'open-ended anger', 'closed-ended anger', 'open-ended sympathy', 'closed-ended sympathy'), i=3, m.osad.OvP, m.sad.OvP, m.oanger.OvP, m.angry.OvP, m.osymp.OvP, m.symp.OvP)
OvP.anger <- ci.plot('objective vs. perspective taking','angry letter', c('open-ended sadness', 'closed-ended sadness', 'open-ended anger', 'closed-ended anger', 'open-ended sympathy', 'closed-ended sympathy'), i=5, m.osad.OvP, m.sad.OvP, m.oanger.OvP, m.angry.OvP, m.osymp.OvP, m.symp.OvP)

ci.plot.data <- rbind(OvC.sad, OvC.anger, OvP.sad, OvP.anger)
ci.plot.data$emotions <- factor(ci.plot.data$emotions, levels=c('open-ended sadness', 'closed-ended sadness', 'open-ended anger', 'closed-ended anger', 'open-ended sympathy', 'closed-ended sympathy'))

ggplot(test, aes(y=point.est, x=emotions, ymin=lb, ymax=ub)) +
    geom_pointrange(stat='identity',position='dodge') +
    facet_wrap(~letter*ptcond) + 
    coord_flip() +
    theme_classic() +
    geom_hline(y=0, color='grey') +
    labs(x="Subjects' Emotions", y="95% Confidence Intervals for the Difference in Emotions by Condition")







##### 6. Analysis of Own Appraisals #####

m.pleas1 <- polr(factor(pleas)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.pleas2 <- polr(factor(pleas)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.pleas3 <- polr(factor(pleas)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.pleas1)
confint(m.pleas2)
confint(m.pleas3)

m.immoral1 <- polr(factor(immoral)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.immoral2 <- polr(factor(immoral)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.immoral3 <- polr(factor(immoral)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.immoral1)
confint(m.immoral2)
confint(m.immoral3)

m.selfag1 <- polr(factor(selfag)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.selfag2 <- polr(factor(selfag)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.selfag3 <- polr(factor(selfag)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.selfag1)
confint(m.selfag2)
confint(m.selfag3)

m.selfpow1 <- polr(factor(selfpow)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.selfpow2 <- polr(factor(selfpow)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.selfpow3 <- polr(factor(selfpow)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.selfpow1)
confint(m.selfpow2)
confint(m.selfpow3)

m.targag1 <- polr(factor(targag)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.targag2 <- polr(factor(targag)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.targag3 <- polr(factor(targag)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.targag1)
confint(m.targag2)
confint(m.targag3)

m.targpow1 <- polr(factor(targpow)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.targpow2 <- polr(factor(targpow)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.targpow3 <- polr(factor(targpow)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.targpow1)
confint(m.targpow2)
confint(m.targpow3)

m.otherag1 <- polr(factor(otherag)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.otherag2 <- polr(factor(otherag)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.otherag3 <- polr(factor(otherag)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)
confint(m.otherag1)
confint(m.otherag2)
confint(m.otherag3)

m.sitag1 <- polr(factor(sitag)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.sitag2 <- polr(factor(sitag)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.sitag3 <- polr(factor(sitag)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)

m.mixag1 <- polr(factor(mixag)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.mixag2 <- polr(factor(mixag)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.mixag3 <- polr(factor(mixag)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)

m.othpow1 <- polr(factor(othpow)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.othpow2 <- polr(factor(othpow)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.othpow3 <- polr(factor(othpow)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)

m.noonepow1 <- polr(factor(noonepow)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.noonepow2 <- polr(factor(noonepow)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.noonepow3 <- polr(factor(noonepow)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)

m.sitcont1 <- polr(factor(sitcont)~sad.angry+OvP.sad+CvOP.sad+OvP.angry+CvOP.angry, data=pt)
m.sitcont2 <- polr(factor(sitcont)~sad.angry+OvC.sad+PvOC.sad+OvC.angry+PvOC.angry, data=pt)
m.sitcont3 <- polr(factor(sitcont)~sad.angry+CvP.sad+OvCP.sad+CvP.angry+OvCP.angry, data=pt)




with(pt, round(cor(cbind(pleas, immoral, selfag, selfpow, targag, targpow, otherag, othpow, mixag, noonepow, sitcont), use='complete.obs'), digits=2))

qplot(y=pleas, x=group, data=pt, geom=c('boxplot','jitter'))
qplot(y=immoral, x=group, data=pt, geom=c('boxplot','jitter'))
confint(polr(factor(pleas)~pt_cond*emot_cond, data=pt))
confint(polr(factor(immoral)~pt_cond*emot_cond, data=pt))
summary(lm(pleas~pt_cond*emot_cond, data=pt))
summary(lm(immoral~pt_cond*emot_cond, data=pt))

qplot(y=selfag, x=group, data=pt, geom=c('boxplot','jitter'))
qplot(y=selfpow, x=group, data=pt, geom=c('boxplot','jitter'))
ptdata$self.agency <- with(pt, rowMeans(cbind(selfag, selfpow)))
qplot(y=self.agency, x=group, data=pt, geom=c('boxplot','jitter'))

qplot(y=targag, x=group, data=pt, geom=c('boxplot','jitter'))
qplot(y=targpow, x=group, data=pt, geom=c('boxplot','jitter'))
ptdata$targ.agency <- with(pt, rowMeans(cbind(targag, targpow)))
qplot(y=targ.agency, x=group, data=pt, geom=c('boxplot','jitter'))
confint(polr(factor(targag)~pt_cond*emot_cond, data=pt))
confint(polr(factor(targpow)~pt_cond*emot_cond, data=pt))
summary(lm(targ.agency~pt_cond*emot_cond, data=pt))

qplot(y=otherag, x=group, data=pt, geom=c('boxplot','jitter'))
qplot(y=othpow, x=group, data=pt, geom=c('boxplot','jitter'))
ptdata$oth.agency <- with(pt, rowMeans(cbind(otherag, othpow)))
qplot(y=oth.agency, x=group, data=pt, geom=c('boxplot','jitter'))
confint(polr(factor(otherag)~pt_cond*emot_cond, data=pt))
confint(polr(factor(othpow)~pt_cond*emot_cond, data=pt))
summary(lm(oth.agency~pt_cond*emot_cond, data=pt))

qplot(y=mixag, x=group, data=pt, geom=c('boxplot','jitter'))
qplot(y=noonepow, x=group, data=pt, geom=c('boxplot','jitter'))
qplot(y=sitcont, x=group, data=pt, geom=c('boxplot','jitter'))
ptdata$sit.control <- with(pt, rowMeans(cbind(noonepow, sitcont)))
qplot(y=sit.control, x=group, data=pt, geom=c('boxplot','jitter'))
confint(polr(factor(mixag)~pt_cond*emot_cond, data=pt))
confint(polr(factor(noonepow)~pt_cond*emot_cond, data=pt))
confint(polr(factor(sitcont)~pt_cond*emot_cond, data=pt))
summary(lm(sit.control~pt_cond*emot_cond, data=pt))


## Valence
a.pleas <- polr(factor(pleas) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.pleas <- polr(factor(pleas) ~ sadpt + objavsad + ptangvsoth, data=pt) 
a.immoral <- polr(factor(immoral) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.immoral <- polr(factor(immoral) ~ sadpt + objavsad + ptangvsoth, data=pt) 

coefs.val <- c(coef(s.pleas)[1], coef(s.immoral)[1], coef(a.pleas)[1], coef(a.immoral)[1])
valence <- factor(rep(c('Pleasantness', 'Morality'),2), levels=c('Morality','Pleasantness'))
cont.val <- factor(rep(c('Sadness','Anger'), each=2))
coefs.lb.val <- c(confint(s.pleas)[1,1], confint(s.immoral)[1,1], confint(a.pleas)[1,1], confint(a.immoral)[1,1])
coefs.ub.val <- c(confint(s.pleas)[1,2], confint(s.immoral)[1,2], confint(a.pleas)[1,2], confint(a.immoral)[1,2])
coef.data.val <- data.frame(cont.val, valence, coefs.val, coefs.lb.val, coefs.ub.val)

ggplot(coef.data.val, aes(y=coefs.val, x=valence)) + 
    geom_pointrange(stat='identity', aes(ymin=coefs.lb.val, ymax=coefs.ub.val), colour='#72524D') + 
    facet_grid(cont.val~.) + 
    theme(strip.background=element_rect(fill='#fcfbf7'), strip.text.y = element_text(color = '#72524D', size=16)) + 
    coord_flip() + 
    ylim(-1.3,1.3) +
    labs(x='Appraisal', y='Contrast 95% CI') +
    theme(panel.background = element_rect(fill = '#fcfbf7'), axis.title.x=element_text(colour='#72524D', size=20), axis.text.x=element_text(colour='#716F6E', size=12), axis.title.y=element_text(colour='#72524D', size=20), axis.text.y=element_text(colour='#716F6E', size=12))


## Agency
a.targag <- polr(factor(targag) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.targag <- polr(factor(targag) ~ sadpt + objavsad + ptangvsoth, data=pt) 
a.targpow <- polr(factor(targpow) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.targpow <- polr(factor(targpow) ~ sadpt + objavsad + ptangvsoth, data=pt) 
a.othag <- polr(factor(otherag) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.othag <- polr(factor(otherag) ~ sadpt + objavsad + ptangvsoth, data=pt) 
a.othpow <- polr(factor(othpow) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.othpow <- polr(factor(othpow) ~ sadpt + objavsad + ptangvsoth, data=pt) 

coefs.ag <- c(coef(s.targag)[1], coef(s.targpow)[1], coef(s.othag)[1], coef(s.othpow)[1], coef(a.targag)[1], coef(a.targpow)[1], coef(a.othag)[1], coef(a.othpow)[1])
agency <- factor(rep(c('Target Agency', 'Target Power', 'Other Agency', 'Other Power'),2), levels=c('Other Power', 'Other Agency', 'Target Power', 'Target Agency'))
cont.ag <- factor(rep(c('Sadness','Anger'), each=4), levels=c('Sadness', 'Anger'))
coefs.lb.ag <- c(confint(s.targag)[1,1], confint(s.targpow)[1,1], confint(s.othag)[1,1], confint(s.othpow)[1,1], confint(a.targag)[1,1], confint(a.targpow)[1,1], confint(a.othag)[1,1], confint(a.othpow)[1,1])
coefs.ub.ag <- c(confint(s.targag)[1,2], confint(s.targpow)[1,2], confint(s.othag)[1,2], confint(s.othpow)[1,2], confint(a.targag)[1,2], confint(a.targpow)[1,2], confint(a.othag)[1,2], confint(a.othpow)[1,2])
coef.data.ag <- data.frame(cont.ag, agency, coefs.ag, coefs.lb.ag, coefs.ub.ag)

ggplot(coef.data.ag, aes(y=coefs.ag, x=agency)) + 
    geom_pointrange(stat='identity', aes(ymin=coefs.lb.ag, ymax=coefs.ub.ag), colour='#72524D') + 
    facet_grid(cont.ag~.) + 
    theme(strip.background=element_rect(fill='#fcfbf7'), strip.text.y = element_text(color = '#72524D', size=16)) + 
    coord_flip() + 
    ylim(-1.3,1.3) +
    labs(x='Appraisal', y='Contrast 95% CI') +
    theme(panel.background = element_rect(fill = '#fcfbf7'), axis.title.x=element_text(colour='#72524D', size=20), axis.text.x=element_text(colour='#716F6E', size=12), axis.title.y=element_text(colour='#72524D', size=20), axis.text.y=element_text(colour='#716F6E', size=12))

## Situational Control
a.mixag <- polr(factor(mixag) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.mixag <- polr(factor(mixag) ~ sadpt + objavsad + ptangvsoth, data=pt)
a.sitag <- polr(factor(sitag) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.sitag <- polr(factor(sitag) ~ sadpt + objavsad + ptangvsoth, data=pt)
a.sitcont <- polr(factor(sitcont) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.sitcont <- polr(factor(sitcont) ~ sadpt + objavsad + ptangvsoth, data=pt)
a.noonepow <- polr(factor(noonepow) ~ angerpt + ptsvang + objsvsoth, data=pt) 
s.noonepow <- polr(factor(noonepow) ~ sadpt + objavsad + ptangvsoth, data=pt)

coefs.cont <- c(coef(s.mixag)[1], coef(s.sitag)[1], coef(s.sitcont)[1], coef(s.noonepow)[1], coef(a.mixag)[1], coef(a.sitag)[1], coef(a.sitcont)[1], coef(a.noonepow)[1])
control <- factor(rep(c('Mixed Agency', 'Situational Agency', 'Situational Control', 'No One Control'),2), levels=rev(c('Mixed Agency', 'Situational Agency', 'Situational Control', 'No One Control')))
cont.control <- factor(rep(c('Sadness','Anger'), each=4), levels=c('Sadness', 'Anger'))
coefs.lb.cont <- c(confint(s.mixag)[1,1], confint(s.sitag)[1,1], confint(s.sitcont)[1,1], confint(s.noonepow)[1,1], confint(a.mixag)[1,1], confint(a.sitag)[1,1], confint(a.sitcont)[1,1], confint(a.noonepow)[1,1])
coefs.ub.cont <- c(confint(s.mixag)[1,2], confint(s.sitag)[1,2], confint(s.sitcont)[1,2], confint(s.noonepow)[1,2], confint(a.mixag)[1,2], confint(a.sitag)[1,2], confint(a.sitcont)[1,2], confint(a.noonepow)[1,2])
coef.data.cont <- data.frame(cont.control, control, coefs.cont, coefs.lb.cont, coefs.ub.cont)

ggplot(coef.data.cont, aes(y=coefs.cont, x=control)) + 
    geom_pointrange(stat='identity', aes(ymin=coefs.lb.cont, ymax=coefs.ub.cont), colour='#72524D') + 
    facet_grid(cont.control~.) + 
    theme(strip.background=element_rect(fill='#fcfbf7'), strip.text.y = element_text(color = '#72524D', size=16)) + 
    coord_flip() + 
    ylim(-1.3,1.3) +
    labs(x='Appraisal', y='Contrast 95% CI') +
    theme(panel.background = element_rect(fill = '#fcfbf7'), axis.title.x=element_text(colour='#72524D', size=20), axis.text.x=element_text(colour='#716F6E', size=12), axis.title.y=element_text(colour='#72524D', size=20), axis.text.y=element_text(colour='#716F6E', size=12))



###### 7. Evidence or Mediation through Reappraisal #####

a.angry.1 <- polr(factor(angry) ~ angerpt + ptsvang + objsvsoth, data=pt) 
confint(a.angry.1)
a.angry.2 <- polr(factor(angry) ~ angerpt + ptsvang + objsvsoth + otherag, data=pt)
confint(a.angry.2)
a.angry.3 <- polr(factor(angry) ~ angerpt + ptsvang + objsvsoth + sitcont, data=pt)
confint(a.angry.3)
s.angry.1 <- polr(factor(angry) ~ sadpt + objavsad + ptangvsoth, data=pt) 
confint(s.angry.1)
s.angry.2 <- polr(factor(angry) ~ sadpt + objavsad + ptangvsoth + targag + targpow, data=pt) 
confint(s.angry.2)
s.angry.3 <- polr(factor(angry) ~ sadpt + objavsad + ptangvsoth + sitcont, data=pt)
confint(s.angry.3)

a.mad.1 <- polr(factor(mad) ~ angerpt + ptsvang + objsvsoth, data=pt) 
confint(a.mad.1)
a.mad.2 <- polr(factor(mad) ~ angerpt + ptsvang + objsvsoth + otherag, data=pt)
confint(a.mad.2)
a.mad.3 <- polr(factor(mad) ~ angerpt + ptsvang + objsvsoth + sitcont, data=pt)
confint(a.mad.3)
s.mad.1 <- polr(factor(mad) ~ sadpt + objavsad + ptangvsoth, data=pt) 
confint(s.mad.1)
s.mad.2 <- polr(factor(mad) ~ sadpt + objavsad + ptangvsoth + targag + targpow, data=pt) 
confint(s.mad.2)
s.mad.3 <- polr(factor(mad) ~ sadpt + objavsad + ptangvsoth + sitcont, data=pt)
confint(s.mad.3)

a.symp.1 <- polr(factor(symp) ~ angerpt + ptsvang + objsvsoth, data=pt) 
confint(a.symp.1)
a.symp.2 <- polr(factor(symp) ~ angerpt + ptsvang + objsvsoth + otherag, data=pt)
confint(a.symp.2)
a.symp.3 <- polr(factor(symp) ~ angerpt + ptsvang + objsvsoth + sitcont, data=pt)
confint(a.symp.3)
s.symp.1 <- polr(factor(symp) ~ sadpt + objavsad + ptangvsoth, data=pt) 
confint(s.symp.1)
s.symp.2 <- polr(factor(symp) ~ sadpt + objavsad + ptangvsoth + targag + targpow, data=pt) 
confint(s.symp.2)
s.symp.3 <- polr(factor(symp) ~ sadpt + objavsad + ptangvsoth + sitcont, data=pt)
confint(s.symp.3)







####### Exploratory Graphs ########

ggplot(pt, aes(y=sad, x=group, colour=female)) + 
    geom_boxplot() + 
    geom_jitter(position=position_jitter(width=.2, height=.2)) + 
    scale_colour_gradient(low = 'yellow', high='dark red')


#demo of improving graphs
demo1 <- with(ptopen, prop.plot(o_sad, ptfactor, emotfactor, ylab='Proportion Sad', xlab='Perspective Taking Condition', leglab="Melissa's Emotion"))
demo2 <- with(ptopen, prop.plot(o_sad, emotfactor, ptfactor, ylab='Proportion Sad', xlab="Melissa's Emotion", leglab="Perspective Taking Condition"))
multiplot(demo1, demo2)


#plots for report to Phoebe
# ad hoc function
ci.plot <- function(ptcond, emocond, emotions, i, ...){
    ptcond <- factor(rep(ptcond, length(list(...))), )
    emocond <- factor(rep(emocond, length(list(...))), )
    emotions <- factor(emotions)
    point.est <- unlist(lapply(list(...), function(x){coef(x)[i]}))
    lb <- unlist(lapply(list(...), function(x){confint(x)[i,1]}))
    ub <- unlist(lapply(list(...), function(x){confint(x)[i,2]}))
    result <- data.frame(ptcond=ptcond, letter=emocond, emotions=emotions, point.est=point.est, lb=lb, ub=ub)
    return(result)
}

CvP.sad <- ci.plot('control vs. perspective taking','sad letter', c('sympathy','anger','sadness'), i=3, m.symp.PvC,m.angry.PvC,m.sad.PvC)
CvP.angry <- ci.plot('control vs. perspective taking','angry letter', c('sympathy','anger','sadness'), i=5, m.symp.PvC,m.angry.PvC,m.sad.PvC)
OvC.sad <- ci.plot('objective vs. perspective taking','sad letter', c('sympathy','anger','sadness'), i=3, m.symp.OvC,m.oangry.OvC,m.osad.OvC)
OvC.angry <- ci.plot('objective vs. perspective taking','angry letter', c('sympathy','anger','sadness'), i=5, m.symp.OvC,m.oangry.OvC,m.osad.OvC)
oCvP.sad <- ci.plot('control vs. perspective taking','sad letter', c('open sympathy','open anger','open sadness'), i=3, m.symp.PvC,m.angry.PvC,m.sad.PvC)
oCvP.angry <- ci.plot('control vs. perspective taking','angry letter', c('open sympathy','open anger','open sadness'), i=5, m.symp.PvC,m.angry.PvC,m.sad.PvC)
oOvC.sad <- ci.plot('objective vs. perspective taking','sad letter', c('open sympathy','open anger','open sadness'), i=3, m.symp.OvC,m.oangry.OvC,m.osad.OvC)
oOvC.angry <- ci.plot('objective vs. perspective taking','angry letter', c('open sympathy','open anger','open sadness'), i=5, m.symp.OvC,m.oangry.OvC,m.osad.OvC)
test <- rbind(CvP.sad, CvP.angry, OvC.sad, OvC.angry,oCvP.sad, oCvP.angry, oOvC.sad, oOvC.angry)

ggplot(test, aes(y=point.est, x=emotions, ymin=lb, ymax=ub)) +
    geom_pointrange(stat='identity',position='dodge',aes(color=emotions)) +
    facet_wrap(~letter*ptcond) + 
    coord_flip() +
    theme_classic() +
    geom_hline(y=0, color='grey')
    

## open-ended plots
CvP.sad.open <- ci.plot('control vs. perspective taking', 'sad letter', c('sad','angry','sympathetic'), i=3, m.o_sad3, m.o_anger3, m.o_symp3)
CvP.angry.open <- ci.plot('control vs. perspective taking', 'angry letter', c('sad','angry','sympathetic'), i=5, m.o_sad3, m.o_anger3, m.o_symp3)
OvC.sad.open <- ci.plot('objective vs. control', 'sad letter', c('sad','angry','sympathetic'), i=3, m.o_sad2, m.o_anger2, m.o_symp2)
OvC.angry.open <- ci.plot('objective vs. control', 'angry letter', c('sad','angry','sympathetic'), i=5, m.o_sad2, m.o_anger2, m.o_symp2)
OvP.sad.open <- ci.plot('objective vs. perspective taking', 'sad letter', c('sad','angry','sympathetic'), i=3, m.o_sad1, m.o_anger1, m.o_symp1)
OvP.angry.open <- ci.plot('objective vs. perspective taking', 'angry letter', c('sad','angry','sympathetic'), i=5, m.o_sad1, m.o_anger1, m.o_symp1)

open.cis <- rbind(CvP.sad.open,CvP.angry.open,OvC.sad.open,OvC.angry.open,OvP.sad.open,OvP.angry.open)

ggplot(open.cis, aes(y=point.est,x=emotions,ymin=lb, ymax=ub)) + geom_pointrange(stat='identity',position='dodge', aes(color=emotions)) + facet_wrap(~letter*ptcond) + coord_flip() + theme_classic() + geom_hline(y=0, color='grey')

## closed-ended plots
CvP.sad.close <- ci.plot('control vs. perspective taking', 'sad letter', c('sad','down','angry','mad','sympathetic','compassionate'), i=2, m.sad3, m.down3, m.angry3, m.mad3, m.symp3, m.comp3)
CvP.angry.close <- ci.plot('control vs. perspective taking', 'angry letter', c('sad','down','angry','mad','sympathetic','compassionate'), i=4, m.sad3, m.down3, m.angry3, m.mad3, m.symp3, m.comp3)
OvC.sad.close <- ci.plot('objective vs. control', 'sad letter', c('sad','down','angry','mad','sympathetic','compassionate'), i=2, m.sad2, m.down2, m.angry2, m.mad2, m.symp2, m.comp2)
OvC.angry.close <- ci.plot('objective vs. control', 'angry letter', c('sad','down','angry','mad','sympathetic','compassionate'), i=4, m.sad2, m.down2, m.angry2, m.mad2, m.symp2, m.comp2)
OvP.sad.close <- ci.plot('objective vs. perspective taking', 'sad letter', c('sad','down','angry','mad','sympathetic','compassionate'), i=2, m.sad1, m.down1, m.angry1, m.mad1, m.symp1, m.comp1)
OvP.angry.close <- ci.plot('objective vs. perspective taking', 'angry letter', c('sad','down','angry','mad','sympathetic','compassionate'), i=4, m.sad1, m.down1, m.angry1, m.mad1, m.symp1, m.comp1)

close.cis <- rbind(CvP.sad.close,CvP.angry.close,OvC.sad.close,OvC.angry.close,OvP.sad.close,OvP.angry.close)

ggplot(close.cis, aes(y=point.est,x=emotions,ymin=lb, ymax=ub)) + geom_pointrange(stat='identity', position='dodge', aes(color=emotions)) + facet_wrap(~letter*ptcond) + coord_flip() + scale_y_continuous(limits=c(-1.2,1.2)) + theme_classic() + geom_hline(y=0, color='grey')



## Appraisals

CvP.sad.close <- ci.plot('control vs. perspective taking', 'sad letter', c('pleasant', 'immoral','target agency','target power','other agency','other power','situation agency','situation power','mixed agency','no one power'), i=2, m.pleas3, m.immoral3, m.targag3, m.targpow3, m.otherag3, m.othpow3, m.sitag3, m.sitcont3, m.mixag3, m.noonepow3)
CvP.angry.close <- ci.plot('control vs. perspective taking', 'angry letter', c('pleasant', 'immoral','target agency','target power','other agency','other power','situation agency','situation power','mixed agency','no one power'), i=4, m.pleas3, m.immoral3, m.targag3, m.targpow3, m.otherag3, m.othpow3, m.sitag3, m.sitcont3, m.mixag3, m.noonepow3)
OvC.sad.close <- ci.plot('objective vs. control', 'sad letter', c('pleasant', 'immoral','target agency','target power','other agency','other power','situation agency','situation power','mixed agency','no one power'), i=2, m.pleas2, m.immoral2, m.targag2, m.targpow2, m.otherag2, m.othpow2, m.sitag2, m.sitcont2, m.mixag2, m.noonepow2)
OvC.angry.close <- ci.plot('objective vs. control', 'angry letter', c('pleasant', 'immoral','target agency','target power','other agency','other power','situation agency','situation power','mixed agency','no one power'), i=4, m.pleas2, m.immoral2, m.targag2, m.targpow2, m.otherag2, m.othpow2, m.sitag2, m.sitcont2, m.mixag2, m.noonepow2)
OvP.sad.close <- ci.plot('objective vs. perspective taking', 'sad letter', c('pleasant', 'immoral','target agency','target power','other agency','other power','situation agency','situation power','mixed agency','no one power'), i=2, m.pleas1, m.immoral1, m.targag1, m.targpow1, m.otherag1, m.othpow1, m.sitag1, m.sitcont1, m.mixag1, m.noonepow1)
OvP.angry.close <- ci.plot('objective vs. perspective taking', 'angry letter', c('pleasant', 'immoral','target agency','target power','other agency','other power','situation agency','situation power','mixed agency','no one power'), i=4, m.pleas1, m.immoral1, m.targag1, m.targpow1, m.otherag1, m.othpow1, m.sitag1, m.sitcont1, m.mixag1, m.noonepow1)

close.cis <- rbind(CvP.sad.close,CvP.angry.close,OvC.sad.close,OvC.angry.close,OvP.sad.close,OvP.angry.close)
close.cis$appraisals <- close.cis$emotions

ggplot(close.cis, aes(y=point.est,x=appraisals,ymin=lb, ymax=ub)) + geom_pointrange(stat='identity', position='dodge', aes(color=appraisals)) + facet_wrap(~letter*ptcond) + coord_flip() + scale_y_continuous(limits=c(-1.2,1.2)) + theme_classic() + geom_hline(y=0, color='grey')








######### Poster for SPSP ########

# code data into groups
ptdata$groups <- with(pt, ifelse(ptfactor=='objective' & emotfactor=='sad', 1, ifelse(ptfactor=='control' & emotfactor=='sad', 2, ifelse(ptfactor=='perspective taking' & emotfactor=='sad', 3, ifelse(ptfactor=='objective' & emotfactor=='angry', 4, ifelse(ptfactor=='control' & emotfactor=='angry', 5, ifelse(ptfactor=='perspective taking' & emotfactor=='angry', 6, NA)))))))


### Plot bars - own emotions
ptdata$anger_mean <- rowMeans(pt[,c('angry','mad')])
ptdata$sad_mean <- rowMeans(pt[,c('sad','down')])
ptdata$symp_mean <- rowMeans(pt[,c('comp','symp')])

## NOTE: Data for meta-analysis
with(pt, by(symp_mean, list(ptfactor, emotfactor), mean, na.rm=TRUE))
with(pt, by(symp_mean, list(ptfactor, emotfactor), sd, na.rm=TRUE))
with(pt, by(symp_mean, list(ptfactor, emotfactor), function(x){length(x[which(!is.na(x))])}))
with(pt, by(sad_mean, list(ptfactor, emotfactor), mean, na.rm=TRUE))
with(pt, by(sad_mean, list(ptfactor, emotfactor), sd, na.rm=TRUE))
with(pt, by(sad_mean, list(ptfactor, emotfactor), function(x){length(x[which(!is.na(x))])}))



angerplot <- with(pt, mean.plot(anger_mean, emotfactor, ptfactor, ylim=c(0,5))) 
angerNs <- with(pt, by(anger_mean, list(emotfactor, ptfactor), length))
angerplot + 
    geom_text(aes(label=c(paste("n =",angerNs))), position=position_dodge(width=.9), vjust=-1.8, size=7, family='Montserrat') +
    scale_fill_manual(values=c('#00BFC4','dark grey','#F8766D')) +
    coord_cartesian(ylim=c(1,5)) +
    labs(title="Subjects' Anger by Condition", x="Target's Emotion", y=NULL) +
    guides(fill=guide_legend(title="Reading Perspective")) +
    theme(text=element_text(size=24, family='Montserrat')) 

sadplot <- with(pt, mean.plot(sad_mean, emotfactor, ptfactor, ylim=c(0,5)))
sadNs <- with(pt, by(sad_mean, list(emotfactor, ptfactor), length))
sadplot + 
    geom_text(aes(label=c(paste("n =",sadNs))), position=position_dodge(width=.9), vjust=-1.8, size=7, family='Montserrat') +
    scale_fill_manual(values=c('#00BFC4','dark grey','#F8766D')) +
    coord_cartesian(ylim=c(1,5)) +
    labs(title="Subjects' Sadness by Condition", x="Target's Emotion", y=NULL) +
    guides(fill=guide_legend(title="Reading Perspective")) +
    theme(text=element_text(size=24, family='Montserrat')) 

sympplot <- with(pt, mean.plot(symp_mean, emotfactor, ptfactor, ylim=c(0,5))) 
sympNs <- with(pt, by(symp_mean, list(emotfactor, ptfactor), length))
sympplot + 
    geom_text(aes(label=c(paste("n =",sympNs))), position=position_dodge(width=.9), vjust=-1.8, size=7, family='Montserrat') +
    scale_fill_manual(values=c('#00BFC4','dark grey','#F8766D')) +
    coord_cartesian(ylim=c(1,5)) +
    labs(title="Subjects' Sympathy by Condition", x="Target's Emotion", y=NULL) +
    guides(fill=guide_legend(title="Reading Perspective")) +
    theme(text=element_text(size=24, family='Montserrat')) 
#





## sad vs. angry letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(-1,-1,-1,1,1,1)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(-1,-1,-1,1,1,1)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(-1,-1,-1,1,1,1)))


## Objective vs. PT


# sad letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(-1,0,1,0,0,0)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(-1,0,1,0,0,0)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(-1,0,1,0,0,0)))

# angry letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(0,0,0,-1,0,1)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(0,0,0,-1,0,1)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(0,0,0,-1,0,1)))


## Objective vs. control

# sad letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(-1,1,0,0,0,0)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(-1,1,0,0,0,0)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(-1,1,0,0,0,0)))

# angry letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(0,0,0,-1,1,0)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(0,0,0,-1,1,0)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(0,0,0,-1,1,0)))

## Control vs. PT

# sad letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(0,-1,1,0,0,0)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(0,-1,1,0,0,0)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(0,-1,1,0,0,0)))

# angry letter
with(pt[is.na(ptdata$anger_mean)==FALSE,], t.contrast(anger_mean, groups, c(0,0,0,0,-1,1)))
with(pt[is.na(ptdata$sad_mean)==FALSE,], t.contrast(sad_mean, groups, c(0,0,0,0,-1,1)))
with(pt[is.na(ptdata$symp_mean)==FALSE,], t.contrast(symp_mean, groups, c(0,0,0,0,-1,1)))



### Plot bars - Melissa's emotions

ptdata$manger_mean <- rowMeans(pt[,c('mangry','mmad')])
ptdata$msad_mean <- rowMeans(pt[,c('msad','mdown')])

with(pt, mean.plot(manger_mean, ptfactor, emotfactor, ylim=c(0,5)))
with(pt, mean.plot(msad_mean, ptfactor, emotfactor, ylim=c(0,5)))

## Objective vs. PT

# sad letter
with(pt[is.na(ptdata$manger_mean)==FALSE,], t.contrast(manger_mean, groups, c(-1,0,1,0,0,0)))
with(pt[is.na(ptdata$msad_mean)==FALSE,], t.contrast(msad_mean, groups, c(-1,0,1,0,0,0)))

# angry letter
with(pt[is.na(ptdata$manger_mean)==FALSE,], t.contrast(manger_mean, groups, c(0,0,0,-1,0,1)))
with(pt[is.na(ptdata$msad_mean)==FALSE,], t.contrast(msad_mean, groups, c(0,0,0,-1,0,1)))


## Objective vs. control

# sad letter
with(pt[is.na(ptdata$manger_mean)==FALSE,], t.contrast(manger_mean, groups, c(-1,1,0,0,0,0)))
with(pt[is.na(ptdata$msad_mean)==FALSE,], t.contrast(msad_mean, groups, c(-1,1,0,0,0,0)))

# angry letter
with(pt[is.na(ptdata$manger_mean)==FALSE,], t.contrast(manger_mean, groups, c(0,0,0,-1,1,0)))
with(pt[is.na(ptdata$msad_mean)==FALSE,], t.contrast(msad_mean, groups, c(0,0,0,-1,1,0)))

## Control vs. PT

# sad letter
with(pt[is.na(ptdata$manger_mean)==FALSE,], t.contrast(manger_mean, groups, c(0,-1,1,0,0,0)))
with(pt[is.na(ptdata$msad_mean)==FALSE,], t.contrast(msad_mean, groups, c(0,-1,1,0,0,0)))

# angry letter
with(pt[is.na(ptdata$manger_mean)==FALSE,], t.contrast(manger_mean, groups, c(0,0,0,0,-1,1)))
with(pt[is.na(ptdata$msad_mean)==FALSE,], t.contrast(msad_mean, groups, c(0,0,0,0,-1,1)))


##### Appraisals 
boxplot(pleas ~ ptfactor*emotfactor, data=pt)
boxplot(immoral ~ ptfactor*emotfactor, data=pt)

boxplot(selfag ~ ptfactor*emotfactor, data=pt)
boxplot(selfpow ~ ptfactor*emotfactor, data=pt)

boxplot(targag ~ ptfactor*emotfactor, data=pt)
boxplot(targpow ~ ptfactor*emotfactor, data=pt)

boxplot(otherag ~ ptfactor*emotfactor, data=pt)
boxplot(othpow ~ ptfactor*emotfactor, data=pt)

boxplot(sitag ~ ptfactor*emotfactor, data=pt)
boxplot(sitcont ~ ptfactor*emotfactor, data=pt)
boxplot(mixag ~ ptfactor*emotfactor, data=pt)
boxplot(noonepow ~ ptfactor*emotfactor, data=pt)


cor.round(pt[,c('pleas','immoral','targag','targpow','otherag','othpow','sitag','sitcont','mixag','noonepow')])
fa.parallel(pt[,c('pleas','immoral','targag','targpow','otherag','othpow','sitag','sitcont','mixag','noonepow')], fm='ml')
fa(pt[,c('pleas','immoral','targag','targpow','otherag','othpow','sitag','sitcont','mixag','noonepow')], fm='ml', nfactors=4, rotate='promax')
fa(pt[,c('pleas','immoral','targag','targpow','otherag','othpow','sitag','sitcont','mixag','noonepow')], fm='ml', nfactors=3, rotate='promax')

ptdata$targ <- rowMeans(pt[,c('targag','targpow')])
ptdata$other <- rowMeans(pt[,c('otherag','othpow')])
ptdata$sit <- rowMeans(pt[,c('sitcont','noonepow')])

boxplot(targ ~ ptfactor*emotfactor, data=pt)
boxplot(other ~ ptfactor*emotfactor, data=pt)
boxplot(sit ~ ptfactor*emotfactor, data=pt)
with(pt, mean.plot(targ, emotfactor, ptfactor, ylim=c(0,5)))
with(pt, mean.plot(other, emotfactor, ptfactor, ylim=c(0,5)))
with(pt, mean.plot(sit, emotfactor, ptfactor, ylim=c(0,5)))

## Objective vs. PT

# sad letter
with(pt[is.na(ptdata$targ)==FALSE,], t.contrast(targ, groups, c(-1,0,1,0,0,0)))
with(pt[is.na(ptdata$other)==FALSE,], t.contrast(other, groups, c(-1,0,1,0,0,0)))
with(pt[is.na(ptdata$sit)==FALSE,], t.contrast(sit, groups, c(-1,0,1,0,0,0)))

# angry letter
with(pt[is.na(ptdata$targ)==FALSE,], t.contrast(targ, groups, c(0,0,0,-1,0,1)))
with(pt[is.na(ptdata$other)==FALSE,], t.contrast(other, groups, c(0,0,0,-1,0,1)))
with(pt[is.na(ptdata$sit)==FALSE,], t.contrast(sit, groups, c(0,0,0,-1,0,1)))


## Objective vs. control

# sad letter
with(pt[is.na(ptdata$targ)==FALSE,], t.contrast(targ, groups, c(-1,1,0,0,0,0)))
with(pt[is.na(ptdata$other)==FALSE,], t.contrast(other, groups, c(-1,1,0,0,0,0)))
with(pt[is.na(ptdata$sit)==FALSE,], t.contrast(sit, groups, c(-1,1,0,0,0,0)))

# angry letter
with(pt[is.na(ptdata$targ)==FALSE,], t.contrast(targ, groups, c(0,0,0,-1,1,0)))
with(pt[is.na(ptdata$other)==FALSE,], t.contrast(other, groups, c(0,0,0,-1,1,0)))
with(pt[is.na(ptdata$sit)==FALSE,], t.contrast(sit, groups, c(0,0,0,-1,1,0)))

## Control vs. PT

# sad letter
with(pt[is.na(ptdata$targ)==FALSE,], t.contrast(targ, groups, c(0,-1,1,0,0,0)))
with(pt[is.na(ptdata$other)==FALSE,], t.contrast(other, groups, c(0,-1,1,0,0,0)))
with(pt[is.na(ptdata$sit)==FALSE,], t.contrast(sit, groups, c(0,-1,1,0,0,0)))

# angry letter
with(pt[is.na(ptdata$targ)==FALSE,], t.contrast(targ, groups, c(0,0,0,0,-1,1)))
with(pt[is.na(ptdata$other)==FALSE,], t.contrast(other, groups, c(0,0,0,0,-1,1)))
with(pt[is.na(ptdata$sit)==FALSE,], t.contrast(sit, groups, c(0,0,0,0,-1,1)))
